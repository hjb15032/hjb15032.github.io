<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet"> 
    <link href="./CSS/headers.css" rel="stylesheet">
    <link href="./CSS/mls.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="./favicon.ico" />
    <title>ZeroPads - MLS Page</title>
  </head>
  <style>
      /* Navigation Formatting not active */
      .list:not(.active) {
        background-color: none;
        color: black;
      }

      /* Navigation Formatting active */
      #active{
        font-weight: bold !important;
        border-bottom: 1px solid black;
        padding-bottom:2px;
      }
      #active:hover{
        border-bottom: 1px solid rgba(57, 181, 74, 1) !important;
      }
  </style>

  <body>
    <!-- Navigation Bar-->
    <div class="container">
      <!-- Header Section-->
      <header class="d-flex flex-wrap justify-content-center py-3 mb-4">
        <a href="index.html" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
          <img id="logo" src="./images/header_logo.png" width="63" height="32">
          <span class="fs-4">Team ZeroPads Group Assignment</span>
        </a>
        <!--<nav class="navbar nav-expand-lg navbar-light">
          <ul class="nav nav-pills">
            <li class="nav-item pill-1"><a href="./index.html" class="nav-link">Home</a></li>
            <li class="nav-item pill-1"><a href="./mls.html" class="nav-link active" aria-current="page">Find Housing</a>
            </li>
          </ul>
        </nav> -->
        <nav class="navbar nav-expand-lg bg-transparent">
          <ul class="nav bg-transparent">
            <li class="list"><a href="./index.html" class="nav-link">Home</a></li>
            <li class="list"><a href="./mls.html" class="nav-link" id = "active" aria-current="page">Find Housing</a>
            </li>
          </ul>
        </nav>
      </header>
      <!-- End Header -->
    </div>

    <!-- Body Section-->
    <div class="background">
      <div class="form">
        <h1>To Each Their Home.</h1>
        <p>Let’s find a home that’s perfect for you</p><br />
        <form>
          <input type="text" placeholder="City" aria-label="Search" id="city"><br /><br />
          <select id="state" data-dropup-auto="false"><br><br />
            <option value="">Choose a State</option>
            <option value="AK">Alaska</option>
            <option value="AL">Alabama</option>
            <option value="AR">Arkansas</option>
            <option value="AZ">Arizona</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DC">District of Columbia</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="IA">Iowa</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="MA">Massachusetts</option>
            <option value="MD">Maryland</option>
            <option value="ME">Maine</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MO">Missouri</option>
            <option value="MS">Mississippi</option>
            <option value="MT">Montana</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="NE">Nebraska</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NV">Nevada</option>
            <option value="NY">New York</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="PR">Puerto Rico</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VA">Virginia</option>
            <option value="VT">Vermont</option>
            <option value="WA">Washington</option>
            <option value="WI">Wisconsin</option>
            <option value="WV">West Virginia</option>
            <option value="WY">Wyoming</option>
          </select><br /><br />
          
          <div class="radio" id="radio">
            <label class="radio-inline">
              <input id="r0" type="radio" class="radio-bubble" name="optradio" value="" checked>Show All
            </label>
            <label class="radio-inline">
              <input id="r1" type="radio" name="optradio" value="&property_type=single_family">Single Family
            </label>
            <label class="radio-inline">
              <input id="r2" type="radio" name="optradio" value="&property_type=multi_family">Multi Family
            </label>
            <label class="radio-inline">
              <input id="r3" type="radio" name="optradio" value="&property_type=land">Land
            </label>
          </div>
          <br /><br /><br />
          <button class="button" id="search" value="search" type="button"
            onclick="findHome">Search
          </button>
        </form>
      </div>
    </div>
    <!--</div> -->
    <div class="container">
      <div class="row">
        <div id="cardsArea"></div>
      </div>
    </div>

    <footer class="bg-light text-center text-white">
      <!-- Grid container -->
      <div class="container p-4 pb-0">
        <!-- Section: Social media -->
        <section class="mb-4">
          <!-- Google -->
          <a class="btn btn-primary btn-floating m-1" style="background-color: #39b54a; border-color: #39b54a; border-radius: 0px;" href="https://www.google.com/search?client=firefox-b-1-d&q=ZeroPads+Development+group" target="_blank" role="button"><i
              class="bi bi-google"></i>
          </a>
  
          <!-- Instagram -->
          <a class="btn btn-primary btn-floating m-1" style="background-color: #39b54a; border-color: #39b54a; border-radius: 0px;" href="https://www.instagram.com/zeropads/" target="_blank" role="button"><i
              class="bi bi-instagram"></i>
          </a>
        </section>
        <!-- Section: Social media -->
      </div>
      <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
        ZeroPads Development Group Inc.
      </div>
    </footer>
  </body>

  <script type="text/javascript">
    document.getElementById("search").addEventListener("click", findHome);

    function findHome(e) {
      var cityWithSpace = document.getElementById("city").value;
      var state = document.getElementById("state").value;
      var city = cityWithSpace.split(' ').join('&');
      var searchButton = document.getElementById("search");
      var typeOfHome = document.getElementById("radio").value;
      var typeValue = "";

      if (document.getElementById('r1').checked) {
        typeValue = document.getElementById('r1').value;
      }else if(document.getElementById('r2').checked){
        typeValue = document.getElementById('r2').value;
      }else if(document.getElementById('r3').checked){
        typeValue = document.getElementById('r3').value;
      }

      searchButton.disabled = true;
      searchButton.innerText = "Please Wait...";
      searchButton.style.backgroundColor = "grey";

      if (state.length !== 2) {
        errorHandle(2);
        return;
      }

      const url = 'https://us-real-estate.p.rapidapi.com/for-sale?offset=0&limit=28&state_code=' + state + '&city=' +
        city + '&sort=newest' + typeValue;
      console.log(url);
      fetch(url, {
          "method": "GET",
          "headers": {
            "x-rapidapi-host": "us-real-estate.p.rapidapi.com",
            "x-rapidapi-key": "218ebec704mshd75e7df5031dbe6p133a54jsn81b575145120"
          }
        })
        .then(function (response) {
          if (response.status !== 200) {
            errorHandle(1);
            searchButton.disabled = false;
            searchButton.innerText = "Search";
            return;
          }
          return response.json();
        }).then(function (data) {
          parseData(data);
        }).then(function () {
          searchButton.disabled = false;
          searchButton.innerText = "Search";
          searchButton.style.backgroundColor = "rgba(57, 181, 74, 1)";
        })
        .catch(err => {
          console.log(err);
          searchButton.disabled = false;
          searchButton.innerText = "Search";
          searchButton.style.backgroundColor = "rgba(57, 181, 74, 1)";
          errorHandle(2);
          return;
        });
    }

    function parseData(data) {
      var searchResultStats = [];
      var length = data.data.count;
      if (data.date === null) {
        errorHandle(2);
        return;
      }
      if (data.data.results === null) {
        errorHandle(2);
        return;
      } else{
        for(i = 0; i<length; i++) {
          var postalCode = data.data.results[i].location.address.postal_code;
          var state = data.data.results[i].location.address.state_code; // need state code (abrev) instead of state non abrev for error checking 
          var city = data.data.results[i].location.address.city;
          console.log(city);
          var street = data.data.results[i].location.address.line;
          var listingPrice = data.data.results[i].list_price;
          var listingDate = data.data.results[i].list_date;
          var photos;
          var numBed = data.data.results[i].description.beds;
          var numBath = data.data.results[i].description.baths;
          var sqFoot = data.data.results[i].description.sqft;
          var yearBuilt = data.data.results[i].description.year_built;
          var stateNoAbrev = data.data.results[i].location.address.state;

          if (state !== document.getElementById("state").value) {
            errorHandle(2);
            return;
          }
          if (data.data.results[i].primary_photo === null) {
            photos = "images/house.jpg";
          } else {
            photos = data.data.results[i].primary_photo.href;
          }
          if (numBed === null) {
            numBed = "N.A";
          }
          if (numBath === null) {
            numBath = "N.A";
          }
          if (yearBuilt === null) {
            yearBuilt = "N.A";
          }
          if (sqFoot === null) {
            sqFoot = "N.A";
          }
          if (street === null){
            street = "Street Name Coming Soon"
          }

          var type = data.data.results[i].description.type;
          type = type.replace("_", " ");
          type = type.toUpperCase();
          var listingAgent = data.data.results[i].branding[0].name;

          var singleStats = {
            postalCode: postalCode,
            state: state,
            city: city,
            street: street,
            photos: photos,
            listingPrice: listingPrice,
            numBed: numBed,
            numBath: numBath,
            sqFoot: sqFoot,
            type: type,
            yearBuilt: yearBuilt,
            listingAgent: listingAgent,
            stateNoAbrev: stateNoAbrev,
          };
            searchResultStats.push(JSON.stringify(singleStats));
        }// end for loop
        //Functionality to send array data to HTML
        thelisthtml = "";
        document.getElementById("cardsArea").innerHTML = "";

        var userInputCity = document.getElementById("city").value;
        if(city.toUpperCase() !== userInputCity.toUpperCase()){
          thelisthtml += "<h2 class='text-center'>" + "There are no available listings in " + userInputCity + ", " + stateNoAbrev + "</h2>";
          thelisthtml += "<p class='text-center'>" + "Showing results for cities nearby..." + "</p><br>";
        }else{
          thelisthtml += "<h2 class='text-center'>" + "Showing results for " + city + ", " + stateNoAbrev + "</h2>";
        }
        
        thelisthtml += "<br><br><div class='container'>"
        thelisthtml += "<div class='row'>"
        for (i = 0; i < length; i++) {
          thelisthtml += "<div class='col-sm'>"
          thelisthtml += "<div class='card bg-light' style='width: 18rem;'>"
          thelisthtml += "<img src=" + JSON.parse(searchResultStats[i]).photos +
            " class='card - img - top img-rounded' style='height: 210px' alt='photo of listing'>"
          thelisthtml += " <div class='card-body'>";
          thelisthtml += "<h5 class='card-title'>" + "Listing Price: <strong style='color:rgba(57, 181, 74, 1)'>$" + (JSON
              .parse(searchResultStats[i]).listingPrice).toLocaleString() +
            "</strong></h5>";
          thelisthtml += "<p class='card-text'>" + JSON.parse(searchResultStats[i]).street + " " + "<br>" + JSON.parse(
              searchResultStats[i]).city + ", " +
            JSON.parse(searchResultStats[i]).state + " " + JSON.parse(searchResultStats[i]).postalCode +
            "</p></div>" //end of card body
          thelisthtml += "<ul class='list-group list-group-flush'>"
          thelisthtml += "<li class='list-group-item'>" + "Number of Beds: " + JSON.parse(searchResultStats[i]).numBed +
            "</li>"
          thelisthtml += "<li class='list-group-item'>" + "Number of Baths: " + JSON.parse(searchResultStats[i]).numBath +
            "</li>"
          thelisthtml += "<li class='list-group-item'>" + "Square Feet: " +
            JSON.parse(searchResultStats[i]).sqFoot + "</li>"
          thelisthtml += "<li class='list-group-item'>" + "Year Built: " +
            JSON.parse(searchResultStats[i]).yearBuilt + "</li>"
          thelisthtml += "<li class='list-group-item'>" + "Type: " +
            JSON.parse(searchResultStats[i]).type + "</li></ul>"
          thelisthtml += " <div class='card-body' style='background-color: rgba(57, 181, 74, 1)'>";
          thelisthtml += "<p class='card-text' style='color: white'>" + JSON.parse(searchResultStats[i]).listingAgent +
            "</p></div>"
          thelisthtml+= "</div></div>";
          document.getElementById("cardsArea").innerHTML = thelisthtml;
        }
      }
    }


    function errorHandle(err) {
      var searchButton = document.getElementById("search");
      searchButton.disabled = false;
      searchButton.innerText = "Search";
      searchButton.style.backgroundColor = "rgba(57, 181, 74, 1)";
      document.getElementById("city").value = "";
      document.getElementById("state").value = "";
      document.getElementById("cardsArea").innerHTML = " ";
      document.getElementById("r0").checked = true;

      if (err == 1) {
        alert(
          "We're sorry, your results could not be calculated. Please make sure you enter a valid city/state combination."
        )
      }
      if (err == 2) {
        alert(
          "We're sorry, your results could not be calculated. Please make sure you enter a valid city/state combination. In some cases, we may not have any homes available in the city/state/type of home you provided"
        )
      }
    }
  </script>
</html>